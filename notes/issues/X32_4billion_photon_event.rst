X32_4billion_photon_event
============================

TEST=vvvvlarge_evt cxs_min.sh : about 10 mins for 4.29 billion photons
-----------------------------------------------------------------------

::

    2025-10-16 16:16:28.280 INFO  [1868052] [SSim::AnnotateFrame@197]  caller CSGFoundry::getFrameE tree YES elv NO  extra.size 0 tree_digest f94d93c709d76d3f6c8cc0ad6c25e61a dynamic f94d93c709d76d3f6c8cc0ad6c25e61a
    2025-10-16 16:16:28.281 INFO  [1868052] [QSim::simulate@441]  eventID      0 igs (256, 6, 4, ) tot_ph_0 4294967040 tot_ph_0/M 4294 xxl YES MaxSlot 262000000 MaxSlot/M 262 sslice::Desc(igs_slice)
    sslice::Desc num_slice 18 TotalPhoton 4294967040 TotalPhoton/M 4294.967040
                      start    stop     offset      count    count/M 
       0 : sslice {       0,      15,         0, 251658225}251.658225
       1 : sslice {      15,      30, 251658225, 251658225}251.658225
       2 : sslice {      30,      45, 503316450, 251658225}251.658225
       3 : sslice {      45,      60, 754974675, 251658225}251.658225
       4 : sslice {      60,      75,1006632900, 251658225}251.658225
       5 : sslice {      75,      90,1258291125, 251658225}251.658225
       6 : sslice {      90,     105,1509949350, 251658225}251.658225
       7 : sslice {     105,     120,1761607575, 251658225}251.658225
       8 : sslice {     120,     135,2013265800, 251658225}251.658225
       9 : sslice {     135,     150,2264924025, 251658225}251.658225
      10 : sslice {     150,     165,2516582250, 251658225}251.658225
      11 : sslice {     165,     180,2768240475, 251658225}251.658225
      12 : sslice {     180,     195,3019898700, 251658225}251.658225
      13 : sslice {     195,     210,3271556925, 251658225}251.658225
      14 : sslice {     210,     225,3523215150, 251658225}251.658225
      15 : sslice {     225,     240,3774873375, 251658225}251.658225
      16 : sslice {     240,     255,4026531600, 251658225}251.658225
      17 : sslice {     255,     256,4278189825,  16777215} 16.777215
                      start    stop     offset      count    count/M 
     num_slice 18
    2025-10-16 16:17:03.597 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i    0 dt   35.274382 slice    0 : sslice {       0,      15,         0, 251658225}251.658225
    2025-10-16 16:17:42.800 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i    1 dt   36.166941 slice    1 : sslice {      15,      30, 251658225, 251658225}251.658225
    2025-10-16 16:18:22.211 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i    2 dt   36.361664 slice    2 : sslice {      30,      45, 503316450, 251658225}251.658225
    2025-10-16 16:19:01.820 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i    3 dt   36.607363 slice    3 : sslice {      45,      60, 754974675, 251658225}251.658225
    2025-10-16 16:19:41.570 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i    4 dt   36.736681 slice    4 : sslice {      60,      75,1006632900, 251658225}251.658225
    2025-10-16 16:20:21.385 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i    5 dt   36.776848 slice    5 : sslice {      75,      90,1258291125, 251658225}251.658225
    2025-10-16 16:21:01.049 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i    6 dt   36.615532 slice    6 : sslice {      90,     105,1509949350, 251658225}251.658225
    2025-10-16 16:21:40.706 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i    7 dt   36.700994 slice    7 : sslice {     105,     120,1761607575, 251658225}251.658225
    2025-10-16 16:22:20.554 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i    8 dt   36.830185 slice    8 : sslice {     120,     135,2013265800, 251658225}251.658225
    2025-10-16 16:23:00.609 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i    9 dt   36.781247 slice    9 : sslice {     135,     150,2264924025, 251658225}251.658225
    2025-10-16 16:23:40.233 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i   10 dt   36.640915 slice   10 : sslice {     150,     165,2516582250, 251658225}251.658225
    2025-10-16 16:24:19.883 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i   11 dt   36.625538 slice   11 : sslice {     165,     180,2768240475, 251658225}251.658225
    2025-10-16 16:24:59.492 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i   12 dt   36.683829 slice   12 : sslice {     180,     195,3019898700, 251658225}251.658225
    2025-10-16 16:25:39.402 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i   13 dt   36.730781 slice   13 : sslice {     195,     210,3271556925, 251658225}251.658225
    2025-10-16 16:26:19.201 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i   14 dt   36.676339 slice   14 : sslice {     210,     225,3523215150, 251658225}251.658225
    2025-10-16 16:26:59.007 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i   15 dt   36.718967 slice   15 : sslice {     225,     240,3774873375, 251658225}251.658225
    2025-10-16 16:27:38.815 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i   16 dt   36.712459 slice   16 : sslice {     240,     255,4026531600, 251658225}251.658225
    2025-10-16 16:27:44.380 INFO  [1868052] [QSim::simulate@489]  eventID 0 xxl YES i   17 dt    2.448857 slice   17 : sslice {     255,     256,4278189825,  16777215} 16.777215
    2025-10-16 16:28:37.037 INFO  [1868052] [QSim::simulate@523]  eventID 0 tot_dt  624.089522 tot_ph 4294967040 tot_ph/M 4294.966797 tot_ht  857047734 tot_ht/M 857.047729 tot_ht/tot_ph   0.199547 reset_ YES
    2025-10-16 16:28:37.037 INFO  [1868052] [SEvt::save@4370] /data1/blyth/tmp/GEOM/J25_4_0_opticks_Debug/CSGOptiXSMTest/ALL1_Debug_Philox_vvvvlarge_evt/A000 [genstep,hit]
    2025-10-16 16:34:53.649 INFO  [1868052] [QSim::simulate@541] 
    SEvt__MINTIME
     (TAIL - HEAD)/M 1105.368774 (head to tail of QSim::simulate method) 
     (LEND - LBEG)/M 676.305054 (multilaunch loop begin to end) 
     (PCAT - LEND)/M  52.450851 (topfold concat and clear subfold) 
     (TAIL - BRES)/M 376.611786 (QSim::reset which saves hits) 
     tot_idt/M       624.089905 (sum of kernel execution int64_t stamp differences in microseconds)
     tot_dt          624.089522 int(tot_dt*M)    624089521 (sum of kernel execution double chrono stamp differences in seconds, and scaled to ms) 
     tot_gdt/M        52.034294 (sum of SEvt::gather int64_t stamp differences in microseconds)

    2025-10-16 16:34:53.841  841167325 : ]/data1/blyth/local/opticks_Debug/bin/cxs_min.sh 
    [sreport.main  argv0 sreport dirp /data1/blyth/tmp/GEOM/J25_4_0_opticks_Debug/CSGOptiXSMTest/ALL1_Debug_Philox_vvvvlarge_evt is_executable_sibling_path NO 
    [sreport.main : CREATING REPORT 



52G for 857M hits
-------------------

::

    A[blyth@localhost A000]$ du -h *
    3.0G	f000
    3.0G	f001
    3.0G	f002
    3.0G	f003
    3.0G	f004
    3.0G	f005
    3.0G	f006
    3.0G	f007
    3.0G	f008
    3.0G	f009
    3.0G	f010
    3.0G	f011
    3.0G	f012
    1.3G	f013
    28K	genstep.npy
    52G	hit.npy
    4.0K	NPFold_index.txt
    A[blyth@localhost A000]$ 



52G hit.npy (857M hits)
-------------------------

::

    A[blyth@localhost A000]$ l hit.npy
    53565492 -rw-r--r--. 1 blyth blyth 54851055120 Oct 16 16:30 hit.npy

    A[blyth@localhost A000]$ xxd -l $(( 128 + 16 ))  hit.npy
    00000000: 934e 554d 5059 0100 8600 7b27 6465 7363  .NUMPY....{'desc
    00000010: 7227 3a20 273c 6634 272c 2027 666f 7274  r': '<f4', 'fort
    00000020: 7261 6e5f 6f72 6465 7227 3a20 4661 6c73  ran_order': Fals
    00000030: 652c 2027 7368 6170 6527 3a20 2838 3537  e, 'shape': (857
    00000040: 3034 3737 3334 2c20 342c 2034 292c 207d  047734, 4, 4), }
    00000050: 2020 2020 2020 2020 2020 2020 2020 2020                  
    00000060: 2020 2020 2020 2020 2020 2020 2020 2020                  
    00000070: 2020 2020 2020 2020 2020 2020 2020 2020                  
    00000080: 2020 2020 2020 2020 2020 2020 2020 200a                 .
    A[blyth@localhost A000]$ 


    A[blyth@localhost A000]$ echo $(( 857047734*4*4*4 + 128 + 16 ))   ## MATCHES EXPECTED SIZE
    54851055120


::

    In [1]: f.hit[0]
    Out[1]: 
    array([[-10094.563, -10052.373, -13014.945,    131.872],
           [    -0.674,     -0.309,     -0.671,     -0.   ],
           [     0.696,     -0.57 ,     -0.436,    426.277],
           [     0.   ,      0.   ,      0.   ,      0.   ]], dtype=float32)

    In [2]: f.hit[-1]
    Out[2]: 
    array([[ -9334.104,  -2306.962, -16728.168,    244.678],
           [    -0.619,      0.089,     -0.78 ,     -0.   ],
           [    -0.033,      0.99 ,      0.139,    459.962],
           [     0.   ,      0.   ,        nan,      0.   ]], dtype=float32)


    In [4]: f.hit.shape
    Out[4]: (857047734, 4, 4)



No clocking of the photon index::

    In [5]: ix = f.hit.view(np.uint32)[:,3,2]

    In [6]: ix
    Out[6]: array([         5,          9,         16,         21,         27, ..., 4294967027, 4294967031, 4294967033, 4294967038, 4294967039], shape=(857047734,), dtype=uint32)


    In [7]: dix = np.diff(ix)

    In [8]: dix
    Out[8]: array([ 4,  7,  5,  6, 18, ...,  3,  4,  2,  5,  1], shape=(857047733,), dtype=uint32)

    In [9]: dix.min()
    Out[9]: np.uint32(1)

    In [10]: dix.max()
    Out[10]: np.uint32(96)


iindex shows all instances reached::

    In [11]: ii = f.hit.view(np.uint32)[:,1,3] & 0x7fffffff

    In [12]: ii
    Out[12]: array([42506, 37829, 32904, 39009, 32613, ..., 43187, 40674, 38772, 39489, 42954], shape=(857047734,), dtype=uint32)

    In [13]: ii.min(), ii.max()
    Out[13]: (np.uint32(1), np.uint32(43196))

    In [14]: u_ii, n_ii = np.unique(ii, return_counts=True)

    In [15]: np.c_[u_ii,n_ii]
    Out[15]: 
    array([[    1,   717],
           [    2,   719],
           [    3,   833],
           [    4,   792],
           [    5,   710],
           ...,
           [43192, 27486],
           [43193, 25537],
           [43194, 27140],
           [43195, 31460],
           [43196, 31461]], shape=(43196, 2))


    In [22]: np.all( np.arange(1,len(t_ii)+1) == u_ii )
    Out[22]: np.True_






